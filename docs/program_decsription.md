# 🧩 各プログラム説明（Program Description）

本システムは Flask を中心に、  
**HTML（Jinja2 テンプレート） / CSS / JavaScript / CSV データ** で構成された軽量な分析ダッシュボードである。  
データは CSV から読み込み、Flask 側で集計し、ブラウザ側で可視化する。

本書では、**将来の引き継ぎ開発者が迷わず理解できること**を目的に、各ファイルの役割と責務を整理する。

---

## 1. Python（Flask）側

### 1.1 app.py（アプリケーション本体）

#### 役割
アプリ全体の中核。  
URL ルーティング、CSV の読込と前処理、集計、テンプレートへのデータ受け渡しを担う。

#### 責務
- **ルーティング**：URL に応じた処理へ振り分ける
- **データ読込**：cust / order / itemstock / item を CSV から pandas で読込
- **前処理**：列名小文字化、必要な列名リネーム、型変換
- **フィルタ処理**：性別 / 年齢 / 地域による顧客抽出
- **集計処理**：顧客別・地域別・年代×性別別・在庫関連指標を作成
- **テンプレート出力**：Jinja2 により HTML をレンダリングし、必要なデータを JSON として埋め込む
- **グラフ生成（顧客詳細）**：Plotly で個人別履歴グラフを生成し HTML として渡す

#### 主なエンドポイント
| URL | HTTP | 概要 | 出力テンプレート |
|---|---|---|---|
| `/` | GET | ホーム画面表示 | `index.html` |
| `/dashboard` | GET | KPI/地域/セグメント/在庫などの集計と表示 | `dashboard.html` |
| `/customer/<id>` | GET | 個別顧客の購入履歴表示 | `customer.html` |
| `/stock.html` | GET | 在庫分析と複合検索 | `stock.html` |
| `/search.html` | GET | 顧客ID検索フォーム | `search.html` |

---

## 2. HTML テンプレート（templates/）

### 2.1 index.html（ホーム画面）

#### 役割
アプリの入口となるトップページ。  
利用者に対して各機能ページへの導線を提供する。

#### 特徴
- 静的なランディング画面として動作
- CSV 読込や集計は一切行わない
- Flask の `/` ルート（`home()`）から返される

---

### 2.2 dashboard.html（経営戦略ダッシュボード）

#### 役割
検索条件に基づき、顧客・売上・地域・セグメント・在庫指標を統合表示する中核画面。

#### 表示内容
- **総合 KPI**（総顧客数 / 総売上 / ARPU）
- **地域別売上サマリ**
  - 地図（SVG 日本地図）  
  - 棒グラフ（Chart.js）  
  - 集計表
- **年代×性別セグメント分析**
  - 積み上げ棒グラフ（Chart.js）
  - 集計表
- **顧客ランキング**
  - 購入回数 Top
  - 合計購入額 Top

#### データ受け渡し
Flask で集計された `area_summary` / `age_gender` を  
`window.regionDataFromFlask` / `window.segDataFromFlask` として JS に渡し、描画処理を行う。

---

### 2.3 search.html（顧客ID検索）

#### 役割
顧客 ID を入力させ、該当する個別顧客画面へ遷移させるための検索ページ。

#### 特徴
- CSV 読込や集計は行わない
- 入力値の検証と遷移は `search.js` が担当
- 正常入力時に `/customer/<ID>` へ移動し、Flask の `customer_detail()` が表示処理を引き継ぐ

---

### 2.4 customer.html（個別顧客詳細）

#### 役割
顧客 ID をキーに、個人の購買履歴を可視化する画面。

#### 表示内容
- 顧客プロフィール（氏名 / 年齢 / 性別 / 地域）
- KPI（累計回数 / 累計金額 / 最終購入日）
- **Plotly による購入履歴グラフ**
- 注文履歴テーブル（時系列）

---

### 2.5 stock.html（在庫分析ページ）

#### 役割
商品ごとの発注傾向と在庫状況を分析し、在庫リスクや発注優先度の判断材料を提示する。

#### 表示内容
- 在庫率（stock / total_ordered）の算出結果一覧
- 在庫率 10% 未満のリスク商品 Top5
- 複合検索フォーム（商品コード / 名称 / カテゴリ / 在庫率範囲 / 発注数範囲）




---

## 3. JavaScript（static/）

### 3.1 home.js

### 役割
home.htmlのカルーセル(スライドバナー)の制御を行う。

#### 主な機能
- ページ内のナビゲーションボタンのクリック処理
- スムーズスクロール（必要な場合）
- ダッシュボード / 在庫 / 検索ページへの誘導制御
- 今後機能追加（ニュース表示、フェード演出等）を行うための拡張ポイントとなる

#### 特徴
- Flask 側のデータを必要としない完全フロントエンド処理
- 画面の読み込み速度に影響しないよう、依存ライブラリを持たない
- 他ページと異なりグラフ処理はなく、UIナビゲーションのみの軽量構造

### 3.2 humberger.js

#### 役割
固定ヘッダー左上のハンバーガーアイコンでサイドバーの開閉を制御する。

#### 主な機能
- `.active` クラス切り替えによるサイドバー表示制御
- 3本線 → × へのアニメーション切り替え
- メニュー開閉に伴うメインコンテンツの横スライド


---

### 3.3 dashboard.js

#### 役割
ダッシュボード画面の動的描画と UI 操作すべてを担当する。

#### 主な機能
- 地域別売上棒グラフ（Chart.js）
- 年代×性別積み上げ棒グラフ（Chart.js）
- SVG 日本地図の売上塗り分け
- 地図ホバー時の tooltip（県名 + 売上）
- 地図 / グラフ / 表 のタブ切り替え
- セグメント分析（グラフ / 表）の切り替え

---

### 3.4 search.js

#### 役割
顧客ID検索フォームの入力検証とページ遷移制御を行う。

#### 主な機能
- 入力空欄チェック（空欄なら警告メッセージ）
- 正常入力時、`/customer/<ID>` に遷移する
- フォームのデフォルト送信を抑止し、JS で制御する

---

## 4. CSS（static/）

### 4.1 home.css

#### 役割
ホーム画面（index.html）のヒーローエリアや案内カードのデザインを構築。

#### 主な機能
- トップページのビジュアル（背景色・中央配置）  
- メインボタン（ダッシュボード / 検索 / 在庫）の UI  
- サービス案内セクションのレイアウト調整  
- 余白・タイポグラフィ設定によるブランド統一感の確保

---

### 4.2 humberger.css

#### 役割
固定ヘッダーとサイドバー（ナビゲーション）の UI/UX を構成する。

#### 主な機能
- 固定ヘッダーの位置と重なり制御
- サイドバーのスライド表示
- メニューアイコンのアニメーション
- メニュー展開時のレイアウト調整

---

### 4.3 dashboard.css

#### 役割
ダッシュボード全体の視認性・レイアウト・一貫したUIデザインを担う。

#### 主な機能
- KPI ボックス配置 / 強調
- 表・ボタン・タブ UI の整形
- グラフ領域のサイズ調整とレスポンシブ対応
- 全体の余白・フォント・配色統一

---

### 4.4 search.css

#### 役割
顧客 ID 検索画面（search.html）の入力フォームと結果表示の UI を整える。

#### 主な機能
- 検索フォームの配置・ボタンスタイル  
- 結果テーブルの背景・余白・行強調  
- 「該当なし」表示などのステータスメッセージの整形

---

### 4.5 customer.css

#### 役割
顧客詳細ページ（customer.html）専用のレイアウト調整を行う。

#### 主な機能
- 顧客プロフィール（氏名・年齢・住所）の見やすい配置  
- KPI（累計注文回数・累計金額）の情報ボックスデザイン  
- Plotly グラフと注文履歴テーブルの表示レイアウト  
- テーブルの行ホバーや見出しの視認性向上

---

### 4.6 result.css  
在庫管理ページ（stock.html）専用のスタイルシート。表レイアウトや検索フォームのデザインを統一し、在庫情報を視覚的に見やすくするための装飾を担当する。

### 主な機能  
- 在庫テーブルの装飾（ヘッダー色・行の交互背景・罫線）
- 在庫率10%未満の商品（`.low-stock`）を強調表示
- 検索フォーム（商品コード・商品名・カテゴリなど）の入力欄デザイン
- 各ボタンの配色・ホバー時のスタイル適用
- ページ全体の文字サイズ、行間、レイアウト調整

